<?php

namespace DropBundle\Repository;

use DropBundle\Entity\Ord;

/**
 * OrdRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class OrdRepository extends \Doctrine\ORM\EntityRepository
{
    public function findCountStatuses($userId)
    {
        $new = Ord::NEW_ORDER;
        $inProcessing = Ord::IN_PROCESSING;
        $confirmed = Ord::CONFIRMED;
        $rejected = Ord::REJECTED;
        $shipped = Ord::SHIPPED;
        $nonPurchase = Ord::NON_PURCHASE;

        $sql =
            "SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$new' UNION ALL
             SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$inProcessing' UNION ALL
             SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$confirmed' UNION ALL
             SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$rejected' UNION ALL
             SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$shipped' UNION ALL
             SELECT COUNT(status) FROM ord WHERE user_id=$userId AND status='$nonPurchase'
             ";

        $stmt = $this->_em->getConnection()->prepare($sql);
        $stmt->execute();

        return $stmt->fetchAll();
    }
}

